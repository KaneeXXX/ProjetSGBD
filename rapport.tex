\documentclass[12pt, a4paper]{article}
\usepackage[french]{babel}
\usepackage{parskip}
\usepackage[utf8]{inputenc} % Set input encoding to Unicode UTF-8
\usepackage[T1]{fontenc} % Set character encoding to T1/Cork
\usepackage{minted}
\usepackage{svg}
\usepackage{hyphenat}
\usepackage{amssymb}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{adjustbox}
\usepackage{csquotes}

\AtBeginDocument{\def\labelitemi{$\vcenter{\hbox{\small$\bullet$}}$}}
\newcommand\att[1]{\textnhtt{#1}}

\title{Rapport du Projet de Bases de Données}
\author{Pradana \textsc{Aumars}
  \and
  David \textsc{Behrens}
  \and
  El Hadji Abdoul Aziz \textsc{Kane}
  \and
  Mohamed Lemine \textsc{Mohamed Ahmed}
  \and
  Mohamedou \textsc{Chrif M'hamed}}

\begin{document}
\maketitle
\section{Introduction}
\section{Analyse du problème}
\subsection*{Propriétés}
% Refuge
\att{emailRef}, % email du refuge
\att{nomRef}, % nom du refuge
\att{numTel}, % numéro de téléphone (optionnel) du refuge
\att{secGeo}, % secteur géographique du refuge
\att{dateOuv}, % date d'ouverture du refuge
\att{dateFerm}, % date de fermeture du refuge
\att{nbrPlacesRepas}, % nombre de places pour les repas dans un refuge
\att{nbrPlacesDormir}, % nombre de places pour dormir dans un refuge
\att{textePrez}, % texte de présentation d'un refuge
\att{typePayement}, % type de paiement pour un refuge
\att{prixNuite}, % prix d'une nuite dans un refuge
% Repas
\att{typeRepas}, % type de repas
\att{prixRepas}, % prix d'un repas
% Formation
\att{idForm}, % id de la formation
\att{anneeForm}, % annee de dispension de la formation
\att{nomForm}, % nom de la formation
\att{dateDemForm}, % date de démarrage de la formation
\att{dureeForm}, % durée en jours de la formation
\att{nbrPlacesForm}, % nombre de place total de la formation
\att{descriptForm}, % description de la formation
\att{prixForm}, % prix de la formation
\att{nbrActivite}, % nombre d'activités dans la formation
% Activité
\att{nomActivite}, % nom de l'activité
% Lot
\att{marque}, % marque du matériel
\att{modele}, % modèle du matériel
\att{anneeAchat}, % annee d'achat du matériel
\att{nbPiecesLot}, % nombre de pièces dans le lot
\att{prixPertDegr}, % prix en cas de perte/dégradation d'une pièce du lot
\att{texteInfo}, % texte (optionnel) sur le matériel
\att{anneePerem}, % année de péremption du matériel
% LocationMateriel
\att{idLocationMat}, % id de la location de matériel
\att{nbPiecesReserv}, % nombre de pièces réservées dans un lot
\att{dateRecup},
\att{dateRetour},
\att{nbPiecesPerdues},
% ArbreCategorie
\att{categorie}, % un noeud fils catégorie
\att{categoriePere}, % un noeud père catégorie
% Compte Utilisateur
\att{idUser}, % id du compte utilisateur
\att{coutReserv},
\att{sommeMaterielAbime},
\att{sommeRembourse},
% Membre
\att{emailMem}, % adresse mail du membre
\att{pwdMem}, % mot de passe du membre
\att{nomMem}, % nom du membre
\att{prenomMem}, % prénom du membre
\att{adrPostMem}, % adresse postale du membre
% Adhérent
\att{idAdherent}, % id de l'adhérent
% Réservation de refuge
\att{idReservRef}, % id d'une réservation de refuge
\att{dateReservRef}, % date d'une réservatinon d'une refuge
\att{heureReservRef}, % heure d'une réservation d'une refuge
\att{nbrNuitsReserv}, % nombre de nuits réservées
\att{nbrRepasReserv}, % nombre de repas réservés
\att{prixTotalReserv}, % prix total de la réservation
% Réservation de formation
\att{idReservForm}, % id d'une réservation de formation
% NB : 0/1..* -- 0/1..* => attribut d'association / 
% Liste d'attente
\att{rangReservForm} % rang de l'adhérent dans la liste d'attente

\subsection*{Contraintes}
\begin{table}[h!]
  \tiny
  \begin{adjustbox}{center}
\begin{tabularx}{0.9\paperwidth}{>{\raggedright}XXXX}
\textbf{Dépendances fonctionelles}
& \textbf{Contraintes de valeur}
& \textbf{Contraintes de multiplicité}
& \textbf{Contraintes contextuelles} \\
\midrule
%% Dépendances fonctionnelles
% Refuge
\att{emailRef}
$\rightarrow$
\att{nomRef},
\att{numTel},
\att{secGeo},
\att{dateOuv},
\att{dateFerm},
\att{nbrPlacesRepas},
\att{nbrPlacesDormir},
\att{textePrez},
\att{typePayement},
\att{prixNuite}

% ProposeRepas
\att{emailRef},
\att{typeRepas}
$\rightarrow$
\att{prixRepas}

% Formation
\att{idForm},
\att{anneeForm}
$\rightarrow$
\att{nomForm},
\att{dateDemForm},
\att{dureeForm}
\att{nbrPlacesForm},
\att{descriptForm},
\att{prixForm},
\att{nbrActivite}
\att{rangFormation},

% Lot
\att{marque},
\att{modele},
\att{anneeAchat}
$\rightarrow$
\att{nbPiecesLot},
\att{prixPertDegr},
\att{texteInfo},
\att{anneePerem}

% ArbreCategorie
\att{categorie}
$\rightarrow$
\att{categoriePere}

% AUneCategorie
\att{marque},
\att{modele},
\att{anneeAchat}
$\rightarrow$
\att{categorie}

% Membre
\att{emailMem}
$\rightarrow$
\att{pwdMem},
\att{nomMem},
\att{prenomMem},
\att{adrPostMem}

% PossedeCompte
\att{emailMem}
$\rightarrow$
\att{idUser}

% ReservationRefuge
\att{idReservRef}
$\rightarrow$
\att{dateReservRef},
\att{heureReservRef},
\att{refugeReserv},
\att{idUser},
\att{nbrNuitsReserv},
\att{nbrRepasReserv},
\att{prixTotalReserv}

% ConcerneRefuge
\att{idReservRef}
$\rightarrow$
\att{emailRef}

% ReservationFormation
\att{idReservForm}
$\rightarrow$
\att{idAdherent},
\att{idForm}

% ConcerneFormation
\att{idReservForm}
$\rightarrow$
\att{idForm},
\att{anneeForm}

% LocationMateriel
\att{idLocationMat}
$\rightarrow$
\att{idAdherent},
\att{nbPiecesReserves},
\att{dateRecup},
\att{dateRetour},
\att{nbrPiecesPerdues}

% CompteUtilisateur
\att{idUser}
$\rightarrow$
\att{coutReserv},
\att{sommeMaterielAbime},
\att{sommeRembourse}

& %% Contraintes de valeur
% Refuge
$\att{dateOuv} < \att{dateFerm}$

$\att{nbrPlacesRepas} \geq 0$

$\att{nbrPlacesDormir} \geq 0$

$\att{typePayement} \in \{ \texttt{"espèce"}, \texttt{"chèque"}, \texttt{"carte-bleue"} \}$

$\att{prixNuite} \geq 0$

% Activite
$\att{nomActivite} \in \{ \texttt{"randonnée"}, \texttt{"escalade"}, \texttt{"alpinisme"}, \texttt{"spéologie"}, \texttt{"ski de rando"}, \texttt{"cascade de glace"} \}$

% Repas
$\att{prixRepas} \geq 0$

$\att{typeRepas} \in \{ \texttt{"déjeuner"}, \texttt{"dîner"}, \texttt{"souper"}, \texttt{"casse-croûte"} \}$

% Formation
$\att{dateDemForm.annee} == \att{anneeForm}$

$\att{dureeForm} \geq 0$

$\att{nbrPlacesForm} > 0$

$\att{prixForm} \geq 0$

% Lot
$\att{nbPiecesLot} \geq 0$

$\att{prixPertDegr} \geq 0$

$\att{anneePerem} \geq 1970$

% Réservation de refuge
$\att{dateOuv} < \att{dateReservRef} < \att{dateFerm}$

$\att{nbrNuitsReserv} \geq 0$

$\att{nbrRepasReserv} \geq 0$

$\att{prixTotalReserv} > 0$

% LocationMateriel
$\att{dateRetour} < \att{dateRecup} + 14$

& %% Contraintes de multiplicités
% ReserveRefuge
$\att{idUser} \not\twoheadrightarrow \att{idReservRef}$

% ReserveFormation
$\att{idUser} \not\twoheadrightarrow \att{idReservForm}$

% LoueMateriel
$\att{idUser} \not\twoheadrightarrow \att{idLocationMat}$

% Lot
$\att{marque}, \att{modele}, \att{anneeAchat} \not\rightarrow \att{texteInfo}$

% EstLoue
$\att{marque}, \att{modele}, \att{anneeAchat} \not\twoheadrightarrow \att{idLocationMateriel}$

& %% Contraintes contextuelles
% ReserveRepas
$\att{nbrNuitsReserv} \neq 0 \lor \att{nbrRepasReserv} \neq 0$
\end{tabularx}
\end{adjustbox}
\caption{Table de contraintes}
\end{table}
\section{Conception}
Tout au long du projet, on a rencontré des choix difficiles à faire face aux subtilités du problème.

\begin{itemize}
\item \textbf{Arbre de catégories}.
  Vu que dans un arbre, un noeuds fils à un noeud parent unique, on a donc choisi de modéliser cet arbre avec un table \att{Arbre} d'un seul attribut \att{categorie}.
  On met en place aussi deux associations: \att{AUneCategorie} pour lier l'entité \att{Lot} et \att{Arbre}, et \att{EstParentDe} pour lier \att{Arbre} avec lui-même pour modéliser les relations entre les noeuds.
\item \textbf{Prix d'un repas}.
  Chaque refuge propose des repas à des prix différents donc créer un table avec des attributs \att{typeRepas} et \att{prixRepas} est hors du question.
  Donc on implémente l'attribut \att{prixRepas} comme un attribut d'association \att{ProposeRepas} entre \att{Refuge} et \att{Repas}.
  Même raisonnement pour \att{nbRepasReserv}.
\item \textbf{Adhérent}.
  On a remarqué tôt dans le projet que \att{Adherent} pourrait être un sous-type de \att{Membre}.
  La question est de choisir la bonne implémentation du sous-type.
  L'implémentation d'une \enquote{Réference} nous oblige de faire une jointure avec \att{Adherent} et \att{Membre} qui n'est pas optimal.
  Une \enquote{Duplication} est donc choisie à cause de l'accès facile.
\end{itemize}

Pour la génération du diagramme entité-association, on a utilisé PlantUML qui est très pratique.
Par contre, la création des objets sans titre n'est pas possible pour les attributs d'association comme \att{prixRepas}.

\begin{figure}[h!]
\includesvg[inkscapelatex=false, width=\textwidth]{schema}
\caption{Diagramme entité-association}
\end{figure}

\section{Schéma relationnel}
REFUGE(\underline{emailRef}, nomRef, numTel, secGeo, dateOuv, dateFerm, nbrPlacesRepas, nbrPlacesDormir, textePrez, typePayement, prixNuite)

REPAS(\underline{typeRepas})

RESERVATION\_REFUGE(\underline{idReservRef}, dateReservRef, heureReservRef, nbrNuitsReserv, nbrRepasReserv, prixTotalReserv)
\end{document}

% Local Variables:
% TeX-command-extra-options: "-shell-escape"
% End:
